<!doctype html>
<html>
<head>
    <link href="./normalize.css" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css?family=Lato:100,900&display=swap" rel="stylesheet">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/moment.js/2.13.0/moment.min.js"></script>
	<script src="https://www.chartjs.org/dist/2.9.3/Chart.min.js"></script>
    <script src="https://www.chartjs.org/samples/latest/utils.js"></script>
	<style>
	canvas{
		-moz-user-select: none;
		-webkit-user-select: none;
		-ms-user-select: none;
	}
	</style>
    <link href="./widget.css" rel="stylesheet">
</head>
<body>
    <div class="master-container">
        <h1 id="h1">EOS =<span id="symbol" class="spans">€</span><span class="spans" id="span">2.38</span></h1>
        <!--my key: fd444f02fd13f67cbbbfe6bf9279aa08ca21b36fb99bf2c964790c5b645aa766 -->

        <!--<div id="menu-container">-->
            <div id="menu" style="background-color: white; display: flex; height: 30px; width: 100%;">
                <div id="frst"></div>
                <div class="tabs" id="eos" onclick="toEOS()">EOS</div>
                <div class="tabs" id="btc" onclick="toBTC()">BTC</div>
                <div class="tabs" id="usd" onclick="toUSD()">$</div>
                <div class="tabs" id="eur" onclick="toEUR()">€</div>
                <div id="scnd"></div>
            </div>
        <!--</div>-->        
    </div>
    <div id="chart-container">      
		<canvas id="myChart"></canvas>
	</div>

    <div id="different-master-container">
        <div style="width: 35px; background-color: white;"></div>
        <form>
            <span class="form-spans" id="span1"><input class="inputs" id="frst-input" type="text" value="from EOS" spellcheck="false" onclick="changeInput()"></span>
            <span class="form-spans" id="span2"><input class="inputs" id="scnd-input" readonly type="text" value="to EUR" spellcheck="false"></span>
        </form>
        <div style="width: 7px; background-color: white; "></div>
    </div>
<script>

//FUNCTIONS THAT FETCH DATA FOR GRAPHS
    let prices = [];
    let bogusData = [12, 21, 26, 31, 45, 37, 33, 44, 41, 22, 17, 11, 5, 14, 23, 35, 41, 49, 58, 47, 14, 54, 33, 100, 92, 100, 100, 100, 100, 100, 100, 100, 100];
    let timeRN = Date.now();
    /*fetch('https://min-api.cryptocompare.com/data/v2/histoday?fsym=EOS&tsym=EUR&limit=90&aggregate=1&toTS=' + timeRN)
        .then((resp) => resp.json())
        .then(function(data) {
            for (let i = 0; i < data.Data.Data.length; i++) {
               console.log(data.Data.Data[i].open + " " + i);
                prices.push(data.Data.Data[i].open); 
            }
        })
        .then(function() {*/
            var ctx = document.getElementById('myChart').getContext('2d'); //instantiates Chart class
            //var gradient = ctx.createLinearGradient(0, 0, 0, 260);
            //gradient.addColorStop(0, 'rgba(0, 0, 77, 1)');
            //gradient.addColorStop(1, 'rgba(0, 0, 77, 0)');    
            
            var myChart = new Chart(ctx, {
            type: 'line',
            data: {
            labels: bogusData, //prices, //shld be dates
            datasets: [{
                //label: '',
                data: bogusData, //prices, //these are the values from API
                backgroundColor: 'rgba(0, 0, 0, 0.1)',//gradient, /*[ 'rgba(77, 77, 255, 0.5)' //' 0.8)' //'rgba(248, 148, 6, 0.2)'
                //'rgba(255, 99, 132, 0.2)',
                //'rgba(54, 162, 235, 0.2)',
                //'rgba(255, 206, 86, 0.2)',
                //'rgba(75, 192, 192, 0.2)',
                //'rgba(153, 102, 255, 0.2)',
                //'rgba(255, 159, 64, 0.2)'
                //],
                borderColor: [ 'rgba(0, 0, 77, 0.2)' //'rgba(248, 148, 6, 1)'
                //'rgba(255, 99, 132, 1)',
                //'rgba(54, 162, 235, 1)',
                //'rgba(255, 206, 86, 1)',
                //'rgba(75, 192, 192, 1)',
                //'rgba(153, 102, 255, 1)',
                //'rgba(255, 159, 64, 1)'
                ],
                borderWidth: 1,
                pointStyle: 'rectRot',
                pointRadius: 0,
                lineTension: 0
            }]
        },
    options: {
        legend: {
            position: 'right',
            display: false
        },
        scales: {
            xAxes: [{
                gridLines: {
                    drawOnChartArea: false
                }
            }],
            yAxes: [{
                gridLines: {
                    drawOnChartArea: false
                },    
                ticks: {
                    beginAtZero: false
                }
            }]
        }
    }
});
       // })
//*/


function getCurrentPrice(fiat) {
    fetch('https://min-api.cryptocompare.com/data/price?fsym=EOS&tsyms=' + fiat + '&api_key=fd444f02fd13f67cbbbfe6bf9279aa08ca21b36fb99bf2c964790c5b645aa766')
        .then((resp) => resp.json())
        .then(function(data) {
            console.log('data is: ' + JSON.stringify(data));
            let price;
            fiat === 'EUR' ? price = data.EUR.toFixed(2) : price = data.USD.toFixed(2);     
            document.getElementById('span').innerHTML = price;
        })

/*Catch errors somehow
    .catch(function() {
         document.getElementById('h1').innerHTML = 'Something went wrong while fetching EOS price';
    });*/
}

//DON'T DELETE:    https://min-api.cryptocompare.com/data/v2/histoday?fsym=EOS&tsym=EUR&limit=90&aggregate=1&toTS=TIMEstampRIGHTNOW

//CALCULATOR FUNCTIONS 
    let input = document.getElementById("frst-input");
    let output = document.getElementById("scnd-input");
    var currentFIAT = 'EUR';
 
    function changeInput() {
        
        let spans = document.getElementsByClassName('form-spans');
        let inputs = document.getElementsByClassName('inputs');
    
        for (let i = 0; i < inputs.length; i++) {
            inputs[i].value = "";
            inputs[i].type = "number"
            inputs[i].style.paddingLeft = "8px";
        }    

        for (let i = 0; i < spans.length; i++) {
            spans[i].style.paddingLeft = '13px';
        }  
        
        let crypto;
        crypto = document.createTextNode('EOS');
        let fiat;
        currentFIAT === 'EUR' ? fiat = document.createTextNode('€') : fiat = document.createTextNode('$');
            
        let innerH = document.getElementById('span1').innerHTML;
        let result = innerH.match(/EOS</);
        if (result === null) {
            document.getElementById('span1').insertBefore(crypto, input);
            document.getElementById('span2').insertBefore(fiat, output);
        }
    }

    function update(userInput) {
        let inFIAT = (document.getElementById('span').innerHTML * userInput).toFixed(2);
        output.value = inFIAT;
    }

    input.oninput =  function(){
        let userInput = parseFloat(input.value);
        update(userInput);
    };

//DIFFERENT TAB FUNCTIONS
function changeFIATsymbols(fiat) {
    if (fiat === 'EUR') {
        document.getElementById('symbol').textContent = '€';
        currentFIAT = 'EUR';
    } else if (fiat === 'USD') {
        document.getElementById('symbol').textContent = '$';
        currentFIAT = 'USD';
    }    
    //document.getElementById('scnd-input').type = 'text';   
    document.getElementById('scnd-input').value = `to ${currentFIAT}`;
}

function toUSD() {   
    getCurrentPrice('USD');
    changeFIATsymbols('USD');
}

function toEUR() {
    getCurrentPrice('EUR');
    changeFIATsymbols('EUR');   
}

//CALLED ONLOAD
getCurrentPrice('EUR');

</script>
</div>
</body>
</html>
